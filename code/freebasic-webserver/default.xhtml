<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0 plus SVG 1.1//EN" "http://www.w3.org/2002/04/xhtml-math-svg/xhtml-math-svg.dtd"[

	<!ENTITY nbsp "&#160;">
	<!ENTITY t "&#160;&#160;&#160;&#160;">
	
]>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.w3.org/1999/xhtml http://www.w3.org/MarkUp/SCHEMA/xhtml11.xsd" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">

<head>
	<title>Вебсервер написанный на FreeBASIC</title>
	<meta name="description" content="Компактный вебсервер, написанный на FreeBASIC. Умеет обрабатывать методы GET, HEAD, PUT, DELETE, TRACE и OPTIONS." />
	<meta name="keywords" content="webserver, http‐сервер, http, вебсервер, freebasic" />
	
	<link href="/styles.css" type="text/css" rel="stylesheet" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	
</head>

<body>

<header>
	
	<nav>
		<a href="/">Главная</a>
		<a href="/src/">Статьи</a>
		<a href="/code/">Проекты</a>
		<a href="/books/">Учебник</a>
		<a href="/links.xhtml">Ссылки</a>
		<a href="/about.xhtml">О сайте</a>
	</nav>
	
</header>

<h1>Вебсервер написанный на FreeBASIC</h1>

<main>
	
	<p>Очень компактный вебсервер, написанный на фрибейсике. Умеет обрабатывать методы CONNECT, GET, HEAD, PUT, DELETE, TRACE и OPTIONS.</p>

	<p>Настоящий сайт работает на этом сервере.</p>

	<p>Скомпилированная программа вместе с исходниками в архиве <a href="/res/freebasic-webserver.zip">FreeBASICWebServer</a>.</p>

	<p>Сервер работает «из коробки», однако методы CONNECT и PUT требует имени пользователя и пароля. Создай в папке с программой файл  «users.config» примерно следующего содержания:</p>
	<p class="codebox"><span>Код</span>&#32;<span>INI‐файл</span><br /><code>
	<span class="inisection">[admins]</span><br />
	user<span class="assignment">=</span>password
	</code></p>

	<p>Где «user» — имя пользователя для авторизации, а «password» — пароль.</p>

	<p>Для метода PUT этот файл должен лежать в корневой директории сайта.</p>




	<h2>Пакетные файлы для компиляции</h2>




	<p>Скомпилировать отладочную версию из консоли можно этой командой:</p>

	<p class="codebox"><span>Код</span> <span>Batch</span><br /><code>
	fbc -mt -x WebServer.exe -g basMain.bas WebServer.bas Network.bas ThreadProc.bas ReadHeadersResult.bas WebUtils.bas ProcessRequests.bas base64-decode.bas WebServerService.bas
	</code></p>



	<p>Для компиляции компактной версии сервера можно воспользоваться следующим пакетным файлом:</p>

	<p class="codebox"><span>Код</span> <span>Batch</span><br /><code>
	@echo off<br />
	REM Следующая строка нужна для 64‐битной Windows, если же Windows 32‐битная, её нужно удалить<br />
	set ProgramFiles=C:\Program Files (x86)<br />
	<br />
	&quot;%ProgramFiles%\FreeBASIC\fbc.exe&quot; -r -lib WebServer.bas Network.bas ThreadProc.bas ReadHeadersResult.bas WebUtils.bas ProcessRequests.bas base64-decode.bas WebServerService.bas<br />
	&quot;%ProgramFiles%\FreeBASIC\bin\win32\as.exe&quot; --32 --strip-local-absolute WebServer.asm -o WebServer.o<br />
	&quot;%ProgramFiles%\FreeBASIC\bin\win32\as.exe&quot; --32 --strip-local-absolute base64-decode.asm -o base64-decode.o<br />
	&quot;%ProgramFiles%\FreeBASIC\bin\win32\as.exe&quot; --32 --strip-local-absolute Network.asm -o Network.o<br />
	&quot;%ProgramFiles%\FreeBASIC\bin\win32\as.exe&quot; --32 --strip-local-absolute ThreadProc.asm -o ThreadProc.o<br />
	&quot;%ProgramFiles%\FreeBASIC\bin\win32\as.exe&quot; --32 --strip-local-absolute ReadHeadersResult.asm -o ReadHeadersResult.o<br />
	&quot;%ProgramFiles%\FreeBASIC\bin\win32\as.exe&quot; --32 --strip-local-absolute WebUtils.asm -o WebUtils.o<br />
	&quot;%ProgramFiles%\FreeBASIC\bin\win32\as.exe&quot; --32 --strip-local-absolute ProcessRequests.asm -o ProcessRequests.o<br />
	&quot;%ProgramFiles%\FreeBASIC\bin\win32\as.exe&quot; --32 --strip-local-absolute "WebServerService.asm" -o "WebServerService.o"<br />
	&quot;%ProgramFiles%\FreeBASIC\bin\win32\gorc&quot; /ni /nw /o /fo version.obj version.rc<br />
	&quot;%ProgramFiles%\FreeBASIC\bin\win32\ld.exe&quot; -m i386pe -e _EntryPoint@0 -subsystem console -s --stack 1048576,1048576 -L &quot;%programfiles%\freebasic\lib\win32&quot; -L &quot;./&quot; &quot;version.obj&quot; &quot;WebServer.o&quot; &quot;ProcessRequests.o&quot; &quot;WebUtils.o&quot; &quot;Network.o&quot; &quot;ReadHeadersResult.o&quot; &quot;ThreadProc.o&quot; &quot;base64-decode.o&quot; &quot;WebServerService.o&quot; -o &quot;WebServer.exe&quot; -( -lkernel32 -lgdi32 -lmsimg32 -luser32 -lversion -ladvapi32 -limm32 -lshlwapi -lole32 -loleaut32 -lshell32 -lcomctl32 -lws2_32 -lmsvcrt -)
	</code></p>

	<p>Также сервер можно скомпилировать как службу Windows (Windows Service), для этого нужно добавить флаг компиляции <code>-d service=true</code>. Загеристрировать и запустить службу можно утилитой <code>sc</code>:</p>

	<p class="codebox"><span>Код</span> <span>Batch</span><br /><code>
	set current_dir=%~dp0<br />
	sc create FBWebServer binPath= &quot;%current_dir%WebServer.exe&quot; start= &quot;auto&quot;<br />
	sc start FBWebServer<br />
	</code></p>


	<h2>Конфигурация сервера и сайтов</h2>

	<p>Серверные настройки лежат в файле «WebServer.ini». Пример:</p>

	<p class="codebox"><span>Код</span>&#32;<span>INI‐файл</span><br /><code>
	<span class="inisection">[WebServer]</span><br />
	ListenAddress<span class="assignment">=</span>0.0.0.0<br />
	Port<span class="assignment">=</span>80<br />
	ConnectBindAddress<span class="assignment">=</span>0.0.0.0<br />
	ConnectBindPort<span class="assignment">=</span>0
	</code></p>

	<dl>
	<dt>ListenAddress</dt>
	<dd>Сетевой адрес, к которому будет привязан вебсервер. По умолчанию это 0.0.0.0, то есть сервер будет ожидать соединений со всех сетевых интерфейсов.</dd>
	</dl>
	<dl>
	<dt>Port</dt>
	<dd>Порт для прослушивания. По умолчанию 80 (стандартный HTTP порт).</dd>
	</dl>
	<dl>
	<dt>ConnectBindAddress</dt>
	<dd>Адрес, к которому будет привязываться сервер для выполнения метода CONNECT. По умолчанию 0.0.0.0.</dd>
	</dl>
	<dl>
	<dt>ConnectBindPort</dt>
	<dd>Порт, к которому будет привязываться сервер для выполнения метода CONNECT. По умолчанию 0.</dd>
	</dl>



	<p>Настройки сайтов лежат в файле «WebSites.ini». Пример:</p>


	<p class="codebox"><span>Код</span>&#32;<span>INI‐файл</span><br /><code>
	<span class="inisection">[localhost]</span><br />
	VirtualPath<span class="assignment">=</span>/<br />
	PhisycalDir<span class="assignment">=</span>c:\programming\сайты\localhost\<br />
	IsMoved<span class="assignment">=</span>0<br />
	MovedUrl<span class="assignment">=</span>http://localhost
	</code></p>

	<p>Каждая секция в файле — это отдельный сайт, определяемый заголовком «Host». Для каждого сайта необходимо создавать отдельную секцию. Также нужно учитывать, что example.org, www.example.org и www.example.org:80 — разные сайты, каждый из которых требует отдельной секции.</p>

	<dl>
	<dt>VirtualPath</dt>
	<dd>Виртуальное имя сайта. Используется в сообщениях об ошибках.</dd>
	</dl>
	<dl>
	<dt>PhisycalDir</dt>
	<dd>Физический каталог, где расположены файлы сайта.</dd>
	</dl>
	<dl>
	<dt>IsMoved</dt>
	<dd>Указывает, что сайт является перенаправлением на другой сайт. Например, клиент делает запрос на example.org, а настоящий сайт находится на www.example.org. В таком случае необходимо установить 1 для перенаправления.</dd>
	</dl>
	<dl>
	<dt>MovedUrl</dt>
	<dd>Адрес сайта, куда сервер будет перенаправлять. Необходимо начинать с «http://»</dd>
	</dl>


	<p>Для того, чтобы сервер вёл журнал сетевых соединений, необходимо создать каталог «logs».</p>


	<h2>Исходный код</h2>

	<p>Актуальная версия исходного кода доступна на гитхабе <a href="https://github.com/zamabuvaraeu/FreeBASICWebServer">FreeBASICWebServer</a>.</p>



	<h2>Поделись ссылочкой в социальных сетях</h2>
	<div id="vk_share_button"></div>
	
</main>

<hr />

<footer>
	<p>Сайт создан по технологии XHTML</p>
	<p>
		<span id="pLiveInternet"></span>
		<a href="http://wscatalog.ru/dir/programmirovanie-na-yazyke-freebasic" title="Сайт есть в Каталоге">
			<img width="88" height="31" src="http://wscatalog.ru/knopka.png" alt="Логотип wscatalog.ru" />
		</a>
		<a href="http://gluci.ru/dir/freebasic-na-russkom" title="Необычный Каталог Сайтов">
			<img width="88" height="31" src="http://gluci.ru/88x31.png" alt="Логотип Глюки" />
		</a> 
	</p>
</footer>

<script type="text/javascript" src="https://vk.com/js/api/share.js?93" charset="windows-1251"></script>

<script type="text/javascript">var docUrl=document.URL.toString();document.getElementById("vk_share_button").innerHTML=VK.Share.button(docUrl, {type: "round"});var idL=document.getElementById("pLiveInternet");var idA=document.createElement("a");idA.href="//www.liveinternet.ru/stat/freebasic.su";idA.title="Счётчик посещений LiveInternet";var idImg=document.createElement("img");idImg.src="//counter.yadro.ru/hit?t44."+Math.round(1+18*Math.random())+";r"+escape(document.referrer)+((typeof(screen)=="undefined")?"":";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+";"+Math.random();idImg.alt="Логотип LiveInternet";idA.appendChild(idImg);idL.appendChild(idA);</script>

</body></html>